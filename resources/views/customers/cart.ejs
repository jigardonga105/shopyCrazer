<head>
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <style>
        #emptyCartDiv {
            width: 75rem;
        }
        
        .mx {
            margin: 0rem 31.5rem;
        }
        
        #emptyCartBtn:hover {
            transition: all 1s ease-in-out;
            transform: scale(0.9);
        }
        
        .cartAddressSelect span {
            font-size: 17px !important;
        }
        
        .moreCartAddressAll:hover {
            background: rgb(204, 248, 242);
            border-radius: 10px;
        }
        
        #moreCartAddress {
            display: none;
            z-index: 11;
        }
        
        .cartPlusMin {
            background: rgb(231, 226, 226);
            font-size: 15px;
        }
        
        .text-12 span {
            font-size: 12px !important;
            font-weight: bold;
        }
        
        .text-12 li {
            font-size: 12px !important;
            font-weight: 500 !important;
            color: black;
        }
    </style>
</head>

<section>
    <% if(user){ %>
        <% if(!session.cart['custID_' + user._id + '_cart' ]){ %>
            <div class="bg-gray-100 p-20">
                <div id="emptyCartDiv" class="bg-white m-auto p-2">
                    <div class="p-3">
                        <h4>My Cart</h4>
                    </div>
                    <div class="p-3">
                        <img class="w-58 h-48 m-auto" src="/img/cart.png" alt="emptyCart">
                    </div>
                    <div class="mx">
                        <span class="block font-bold text-xl m-auto">Your cart is empty!</span>
                        <span class="block text-base mx-3 my-3">Add items to it now.</span>
                        <a href="/">
                            <button id="emptyCartBtn" class="bg-green-600 shadow text-white w-44 h-10 rounded mb-10">
                                Shop Now
                            </button>
                        </a>
                    </div>
                </div>
            </div>
            <% } %>
                <input type="hidden" id="cartData" value="<%= JSON.stringify(session.cart) %>" data-user="<%= user._id %>">
                <input type="hidden" id="prdData" value="<%= JSON.stringify(cartProduct) %>">

                <div id="cartAvailability" class="bg-gray-100 p-20">
                    <div class="grid grid-cols-3 gap-3">
                        <!-- Left side -->
                        <div class="bg-white shadow col-span-2">
                            <div class="p-3">
                                <h4 id="itemLength" class="inline-block"></h4>
                                <div id="deliverToDiv" class="float-right">
                                    <img id="deliverToImg" class="inline-block" alt="Deliver to">
                                    <span class="text-gray-400">Deliver to</span>
                                    <div class="inline-block" id="cartAddress">
                                        <div id="cartAddressSelect" class="cartAddressSelect flex border p-2 cursor-pointer">
                                            <div>
                                                <span class="font-bold">Jigar Donga</span>
                                            </div>
                                            <div>
                                                <span>, Pooja Park, Block-1...</span>
                                            </div>
                                            <div>
                                                <span class="bg-gray-300 p-1 rounded-full ml-1">work</span>
                                                <i class="fas fa-sort-down"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <br>
                                    <div id="moreCartAddress" class="float-right border p-2">
                                        <div class="my-2">
                                            <span class="text-muted text-base ml-3">
                                                Select from saved addresses:
                                            </span>
                                        </div>
                                        <div class="mt-2 moreCartAddressAll">
                                            <div class="cartAddressSelect flex p-2 cursor-pointer">
                                                <div>
                                                    <span class="font-bold">Jigar Donga</span>
                                                </div>
                                                <div>
                                                    <span>, Pooja Park, Block-1...</span>
                                                </div>
                                                <div>
                                                    <span class="bg-gray-300 p-1 rounded-full ml-1">work</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- ====================================================================== -->
                                <!-- ====================================================================== -->
                                <div class="allCartProduct" id="allCartProduct">
                                    <!-- <div class="grid grid-cols-6 my-4 pt-3 border-t">

                                        <div class="flex flex-col col-span-1">
                                            <div class="h-24 overflow-hidden mx-auto">
                                                <img class="w-40" src="/img/mac1.jpeg" alt="Mac">
                                            </div>
                                            <div class="mt-2 mx-auto">
                                                <button class="cartPlusMin rounded-full px-2">-</button>
                                                <span class="bg-gray-100 px-4 py-2">3</span>
                                                <button class="cartPlusMin rounded-full px-2">+</button>
                                            </div>
                                        </div>

                                        <div class="col-span-3 px-2">
                                            <div>
                                                <div>
                                                    <span class="text-base font-bold">PARKER Vector Standard Black body
                                                        with
                                                        free Parker...</span>
                                                </div>
                                                <div>
                                                    <span class="text-base text-muted">Seller: Gada</span>
                                                </div>
                                            </div>
                                            <div class="mt-3">
                                                <span class="font-bold">₹220</span>
                                                <span class="line-through text-base text-muted ml-2">₹400</span>
                                                <span class="text-green-800 font-bold text-sm ml-2">45% off</span>
                                                <span class="text-green-800 font-bold text-sm ml-2">
                                                    7 offer available
                                                </span>
                                            </div>
                                            <div class="mt-4 float-right mr-16">
                                                <button class="shadow px-2 py-1 rounded focus:outline-none">Remove</button>
                                            </div>
                                        </div>

                                        <div class="col-span-2">
                                            <div>
                                                <span class="text-base">
                                                    Delivery by Tue Jul 6 |
                                                    <span class="text-green-900">Free</span>
                                                <span class="line-through">₹40</span>
                                                </span>
                                            </div>
                                            <div>
                                                <span class="text-muted text-sm">7 Days Replacement Policy</span>
                                            </div>
                                        </div>
                                    </div> -->
                                </div>
                            </div>
                        </div>

                        <!-- Right Side -->
                        <div class="bg-white shadow h-96">
                            <div>
                                <div class="p-3 border-b">
                                    <span class="text-muted">PRICE DETAILS</span>
                                </div>

                                <div class="m-3 border-b-4 border-dotted">
                                    <div class="my-3">
                                        <span>Price (2 items)</span>
                                        <span class="float-right">₹1800</span>
                                    </div>
                                    <div class="my-3">
                                        <span>Discount</span>
                                        <span class="float-right text-green-600">- ₹1200</span>
                                    </div>
                                    <div class="my-3">
                                        <span>Delivery Charges</span>
                                        <span class="float-right text-green-600">Free</span>
                                    </div>
                                </div>

                                <div class="m-3 border-b-4 border-dotted">
                                    <div class="my-3">
                                        <span>Total Amount</span>
                                        <span class="float-right font-bold">₹600</span>
                                    </div>
                                </div>

                                <div class="m-3">
                                    <div class="my-3">
                                        <span class="text-green-700 font-bold">You will save ₹1,680 on this order</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <% } %>
</section>

<script>
    function fillDataCart(user, cartData, prdData) {
        document.getElementById('itemLength').innerHTML = `My Cart(${cartData['custID_' + user['_id'] + '_cart'].totalQty})`;

        let allCartProduct = document.getElementById('allCartProduct');
        prdData.map((prd) => {
            console.log(prd);
            let prdStr = `<div class="grid grid-cols-6 my-4 pt-3 border-t">
                            <div class="flex flex-col col-span-1">
                                <div class="h-24 overflow-hidden mx-auto">
                                    <img class="w-40" src="/uploadedImages/${prd.image[0].img}" alt="Mac">
                                </div>
                                <div class="mt-2 mx-auto">
                                    <button class="cartPlusMin rounded-full px-2">-</button>
                                    <span class="bg-gray-100 px-4 py-2">3</span>
                                    <button class="cartPlusMin rounded-full px-2">+</button>
                                </div>
                            </div>

                            <div class="col-span-3 px-2">
                                <div>
                                    <div>
                                        <span class="text-base font-bold">${prd.name.substring(0, 45)}${prd.name.length > 45 ? '...' : ''}</span>
                                    </div>
                                    <div>
                                        <span class="text-base text-muted">Seller: Gada</span>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <span class="font-bold">₹${prd.price}</span>
                                    <span class="line-through text-base text-muted ml-2">₹${prd.price + 600}</span>
                                    <span class="text-green-800 font-bold text-sm ml-2">45% off</span>
                                    <span class="text-green-800 font-bold text-sm ml-2">
                                        ${Object.keys(prd.offer[0]).length} offer available
                                        <i id="cartOfferIcon" class="fas fa-info-circle cursor-pointer"></i>
                                        <div id="cartOfferDiv" class="cartOfferDiv w-72 border absolute z-10 bg-white rounded">
                                            <div class="text-12 p-3">
                                                <div class="m-1 border-b-4 border-dotted">
                                                    <div class="my-1">
                                                        <span class="text-muted">MRP</span>
                                                        <span class="float-right">${prd.price}</span>
                                                    </div>
                                                    <div class="my-1">
                                                        <span class="text-muted">Selling Price</span>
                                                        <span class="float-right">- ₹1200</span>
                                                    </div>
                                                    <div class="my-1">
                                                        <span class="text-muted">Extra Discount</span>
                                                        <span class="float-right text-green-600">Free</span>
                                                    </div>
                                                    <div class="my-1">
                                                        <span class="text-muted">Special Price</span>
                                                        <span class="float-right">₹1800</span>
                                                    </div>
                                                </div>

                                                <div class="m-1 border-b-4 border-dotted">
                                                    <div class="my-1">
                                                        <span class="text-muted">Total</span>
                                                        <span class="float-right font-bold">${prd.price}</span>
                                                    </div>
                                                </div>

                                                <div class="m-1">
                                                    <div class="my-1">
                                                        <span class="text-green-700 font-bold">Save more
                                                            with these offers</span>
                                                    </div>
                                                    <div class="my-1">
                                                        <ul id="cartOfferUl" class="pl-0">
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </span>
                                </div>
                                <div class="mt-4 float-right mr-16">
                                    <button class="shadow px-2 py-1 rounded focus:outline-none">Remove</button>
                                </div>
                            </div>

                            <div class="col-span-2">
                                <div>
                                    <span class="text-base">
                                        Delivery by Tue Jul 6 |
                                        <span class="text-green-900">Free</span>
                                        <span class="line-through">₹40</span>
                                    </span>
                                </div>
                                <div>
                                    <span class="text-muted text-sm">7 Days Replacement Policy</span>
                                </div>
                            </div>
                            </div>`;

            allCartProduct.innerHTML += prdStr;

        })
        let cartOfferUl = document.querySelectorAll('#cartOfferUl');

        for (let i = 0; i < cartOfferUl.length; i++) {

            for (let offer in prdData[i].offer[0]) {

                for (let key in prdData[i].offer[0][offer]) {

                    let li = document.createElement("li");
                    li.classList.add('m-1', 'list-disc')
                    li.innerHTML = `${prdData[i].offer[0][offer][key]}`

                    cartOfferUl[i].appendChild(li);
                }
            }
        }
    }


    let cartDataInp = document.getElementById('cartData');
    let prdDataInp = document.getElementById('prdData');
    if (cartDataInp) {
        let user = JSON.parse(cartDataInp.dataset.user);
        let cartData = JSON.parse(cartDataInp.value);
        let prdData = JSON.parse(prdDataInp.value);

        fillDataCart(user, cartData, prdData)
    }

    let deliverToImg = document.getElementById('deliverToImg');
    let url = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxOCIgaGVpZ2h0PSIxOCI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48ZWxsaXBzZSBjeD0iOSIgY3k9IjE0LjQ3OCIgZmlsbD0iI0ZGRTExQiIgcng9IjkiIHJ5PSIzLjUyMiIvPjxwYXRoIGZpbGw9IiMyODc0RjAiIGQ9Ik04LjYwOSA3LjAxYy0xLjA4IDAtMS45NTctLjgyNi0xLjk1Ny0xLjg0NSAwLS40ODkuMjA2LS45NTguNTczLTEuMzA0YTIuMDIgMi4wMiAwIDAgMSAxLjM4NC0uNTRjMS4wOCAwIDEuOTU2LjgyNSAxLjk1NiAxLjg0NCAwIC40OS0uMjA2Ljk1OS0uNTczIDEuMzA1cy0uODY0LjU0LTEuMzgzLjU0ek0zLjEzIDUuMTY1YzAgMy44NzQgNS40NzkgOC45MjIgNS40NzkgOC45MjJzNS40NzgtNS4wNDggNS40NzgtOC45MjJDMTQuMDg3IDIuMzEzIDExLjYzNCAwIDguNjA5IDAgNS41ODMgMCAzLjEzIDIuMzEzIDMuMTMgNS4xNjV6Ii8+PC9nPjwvc3ZnPg==';
    deliverToImg.setAttribute('src', url);

    let cartAddressSelect = document.getElementById('cartAddressSelect');
    let moreCartAddress = document.getElementById('moreCartAddress');
    cartAddressSelect.addEventListener('click', () => {
        if (moreCartAddress.style.display = 'none') {
            moreCartAddress.style.display = 'block';
        } else {
            moreCartAddress.style.display = 'none';
        }
    })

    let cartOfferIcon = document.querySelectorAll('#cartOfferIcon');
    let cartOfferDiv = document.querySelectorAll('#cartOfferDiv');

    for (let i = 0; i < cartOfferIcon.length; i++) {
        cartOfferDiv[i].style.display = 'none';
        cartOfferIcon[i].addEventListener('mouseover', () => {
            cartOfferDiv[i].style.display = 'inline-block';
        })
        cartOfferDiv[i].addEventListener('mouseover', () => {
            cartOfferDiv[i].style.display = 'inline-block';
        })
        cartOfferDiv[i].addEventListener('mouseout', () => {
            cartOfferDiv[i].style.display = 'none';
        })
        cartOfferIcon[i].addEventListener('mouseout', () => {
            cartOfferDiv[i].style.display = 'none';
        })
    }
</script>